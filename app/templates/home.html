{% extends 'base.html' %}

{% block title %} Home{% endblock title %}

{% block content %}
<section class="login-section">
    <div>
        <h1>Bienvenido {{ username }}</h1>
        <form action="{{ url_for('home.home', username=username) }}" method="POST">
            <input type="text" name="categoria" placeholder="Categoria" required>
            <input type="text" name="task" placeholder="Ingrese una tarea" required>
            <select name="state">
                <option value="En proceso">En proceso</option>
                <option value="Finalizado">Finalizado</option>
            </select>
            <input type="date" name="date" required>
            <button type="submit">Agregar tarea</button>
        </form>
        <h2>Tareas Pendientes</h2>
        <ul>
            {% for task in tasks %}
                <li><strong>Categoria:</strong> {{ task.category }}</li>
                <li><strong>Tarea:</strong> {{ task.task }}</li>
                <li><strong>Fecha:</strong> {{ task.date }}</li>
                <li><strong>Estado:</strong> {{ task.state }}</li>
                {% if task.state == 'Finalizado' %}
                    <li><strong>Fecha de Finalización:</strong> {{ task.fecha_finalizacion }}</li>
                {% endif %}
                <li>
                    <!-- Loop.index en este contexto se usa para mostrar el índice del elemento actual -->
                    <form action="{{ url_for('home.update_task', username=username, task_index=loop.index0) }}" method="POST">
                        <input type="hidden" name="task_index" value="{{ loop.index0 }}">
                        <button type="submit">Marcar como finalizado</button>
                    </form>
                </li>
                <li>
                    <!-- Agregar un evento onclick para mostrar el popup de confirmación -->
                    <button type="button" class="delete-btn" data-task-index="{{ loop.index0 }}">Eliminar</button>
                </li>
                <br>
            {% endfor %}
        </ul>
    </div>
</section>

<!-- Popup de confirmación (oculto) -->
<div id="confirmation-popup" class="popup" style="display: none;">
    <div class="popup-content">
        <span class="close" onclick="closeConfirmationPopup()">&times;</span>
        <p>¿Estás seguro de que deseas eliminar esta tarea?</p>
        <button id="confirmDeleteBtn">Eliminar</button>
        <button class="cancel">Cancelar</button>
    </div>
</div>

<!-- Input hidden para pasar el username a JavaScript -->
<input type="hidden" id="username" value="{{ username }}">

<script src="{{ url_for('static', filename='script.js') }}"></script>
{% endblock %}
